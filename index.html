<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego del Impostor</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 0; background:#0b0b0f; color:#fff; }
    .wrap { max-width: 680px; margin: 0 auto; padding: 18px; }
    .card { background:#141422; border:1px solid #2a2a3c; border-radius: 16px; padding: 16px; margin: 14px 0; }
    label { display:block; font-size: 14px; color:#cfcfe6; margin-bottom:6px; }
    input, textarea {
      width:100%; padding:12px 12px; border-radius:12px;
      border:1px solid #2a2a3c; background:#0f0f18; color:#fff; font-size:16px;
    }
    textarea { min-height: 140px; resize: vertical; }
    button { width:100%; padding:12px 12px; border-radius:12px; border:0; background:#5b5bff; color:#fff; font-size:16px; font-weight:700; cursor:pointer; }
    button.secondary { background:#2a2a3c; }
    .big { font-size: 22px; font-weight: 800; }
    .muted { color:#b8b8d6; }
    .row { display:flex; gap:10px; }
    .row > * { flex:1; }
    .hidden { display:none; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; background:#2a2a3c; color:#d9d9ff; font-size: 13px; }

    /* RECT√ÅNGULO GRANDE (HOLD TO REVEAL) */
    .holdBox{
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
      margin-top: 12px;
      border-radius: 18px;
      border: 1px solid #2a2a3c;
      background: linear-gradient(180deg, #11112a 0%, #0f0f18 100%);
      min-height: 230px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 18px;
      box-shadow: 0 18px 40px rgba(0,0,0,.45);
    }
    .holdTitle{ font-size: 18px; font-weight: 800; margin-bottom: 6px; }
    .holdHint{ font-size: 14px; color:#b8b8d6; }
    .holdMain{ font-size: 22px; font-weight: 900; line-height: 1.2; }
    .holdSub{ margin-top: 10px; font-size: 14px; color:#cfcfe6; }
    .danger{ color:#ff6b6b; }
    .ok{ color:#8affb1; }

    /* switch simple */
    .switchRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:10px; }
    .switchHint{ font-size: 13px; color:#b8b8d6; }
    .toggle{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:12px;
      border:1px solid #2a2a3c; background:#0f0f18;
    }
    .toggle input{ width:auto; }
    .disabledBox{ opacity:.55; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="big">Juego del Impostor</div>
      <div class="muted">Escribe nombres (uno por l√≠nea) y la palabra. Luego p√°sale el tel√©fono a cada jugador para ver su rol.</div>
    </div>

    <div id="setup" class="card">
      <label>Nombres (uno por l√≠nea)</label>
      <textarea id="names" placeholder="Ej.
Rapo
Piter
Carnero
Geret"></textarea>

      <div class="muted" style="margin-top:6px">
        Jugadores detectados: <b id="count">0</b> (m√≠nimo 3).
      </div>

      <div class="switchRow" id="twoImpBox">
        <div>
          <div class="toggle">
            <input id="twoImpostors" type="checkbox" />
            <label for="twoImpostors" style="margin:0; color:#d9d9ff;">Jugar con 2 impostores</label>
          </div>
          <div class="switchHint" id="twoImpHint">Disponible a partir de 5 jugadores.</div>
        </div>
        <span class="pill" id="impCountPill">Impostores: 1</span>
      </div>

      <div style="height:10px"></div>

      <label>Palabra secreta</label>
      <input id="word" type="text" placeholder="Ej. Tibur√≥n" />

      <div style="height:14px"></div>
      <button id="btnStart">Iniciar reparto</button>
      <div style="height:10px"></div>
      <div class="muted">Tip: mant√©n presionado para ver tu rol, suelta para ocultarlo üòâ</div>
    </div>

    <div id="reveal" class="card hidden">
      <div class="pill" id="counter">Turno</div>

      <div id="holdBox" class="holdBox" role="button" aria-label="Mant√©n presionado para revelar">
        <div>
          <div class="holdTitle" id="turnName">Le toca a:</div>
          <div class="holdMain" id="turnLabel">Jugador</div>
          <div class="holdSub" id="holdHint">Mant√©n presionado para ver tu rol</div>
        </div>
      </div>

      <div style="height:12px"></div>
      <button id="btnNext" class="secondary" disabled>Siguiente jugador</button>
      <div class="muted" style="margin-top:10px">El bot√≥n se habilita cuando sueltas (para que no avancen sin ocultar).</div>
    </div>

    <div id="final" class="card hidden">
      <div class="big">¬°Listo!</div>
      <div class="muted">Ya todos vieron su rol.</div>
      <div style="height:14px"></div>
      <div class="big" id="starter"></div>
      <div style="height:14px"></div>
      <button class="secondary" id="btnRestart">Reiniciar</button>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    let n = 0;
    let secretWord = "";
    let impostorIndices = new Set(); // set de indices impostores
    let starterIndex = -1;
    let i = 0;                // jugador actual
    let names = [];           // lista de nombres
    let revealed = false;     // si est√° revelado (presionado)
    let lastTouch = 0;
    let numImpostors = 1;

    function randInt(max) { return Math.floor(Math.random() * max); }

    // Parse de nombres (uno por l√≠nea, elimina vac√≠os)
    function parseNames(raw){
      return (raw || "")
        .split("\n")
        .map(s => s.trim())
        .filter(s => s.length > 0);
    }

    function getPlayerName(idx){
      return (names[idx] && names[idx].trim()) ? names[idx].trim() : `Jugador ${idx + 1}`;
    }

    function updateCounter() {
      $("counter").textContent = `Turno: ${getPlayerName(i)} (${i + 1} de ${n})`;
      $("turnLabel").textContent = getPlayerName(i);
      $("turnName").textContent = "Le toca a:";
    }

    function roleFor(idx) {
      if (impostorIndices.has(idx)) return { text: "üö® Eres el impostor", kind: "danger" };
      return { text: `‚úÖ Tu palabra: ${secretWord}`, kind: "ok" };
    }

    function renderHiddenState(){
      updateCounter();
      $("holdHint").textContent = "Mant√©n presionado para ver tu rol";
      $("turnName").textContent = "Le toca a:";
      $("turnLabel").textContent = getPlayerName(i);
      $("turnLabel").classList.remove("danger", "ok");
    }

    function renderRevealedState(){
      const r = roleFor(i);
      $("turnName").textContent = "Tu rol:";
      $("turnLabel").textContent = r.text;
      $("turnLabel").classList.remove("danger", "ok");
      $("turnLabel").classList.add(r.kind);
      $("holdHint").textContent = "Suelta para ocultar y pasar el tel√©fono";
    }

    function reveal(){
      if (revealed) return;
      revealed = true;
      $("btnNext").disabled = true;
      renderRevealedState();
    }

    function hide(){
      if (!revealed) return;
      revealed = false;
      renderHiddenState();
      $("btnNext").disabled = false;
    }

    function resetUI() {
      $("setup").classList.remove("hidden");
      $("reveal").classList.add("hidden");
      $("final").classList.add("hidden");
      $("btnNext").disabled = true;
      revealed = false;
      renderHiddenState();
    }

    function pickImpostors(count){
      impostorIndices = new Set();
      while (impostorIndices.size < count) {
        impostorIndices.add(randInt(n));
      }
    }

    // --- UI setup: contar nombres y habilitar 2 impostores ---
    function refreshSetupUI(){
      names = parseNames($("names").value);
      n = names.length;
      $("count").textContent = String(n);

      const canTwo = n >= 5;
      const cb = $("twoImpostors");
      const box = $("twoImpBox");
      const hint = $("twoImpHint");

      if (!canTwo) {
        cb.checked = false;
        cb.disabled = true;
        box.classList.add("disabledBox");
        hint.textContent = "Disponible a partir de 5 jugadores.";
        numImpostors = 1;
      } else {
        cb.disabled = false;
        box.classList.remove("disabledBox");
        hint.textContent = "Act√≠valo si quieren m√°s caos üòà";
        numImpostors = cb.checked ? 2 : 1;
      }

      $("impCountPill").textContent = `Impostores: ${numImpostors}`;
    }

    $("names").addEventListener("input", refreshSetupUI);
    $("twoImpostors").addEventListener("change", refreshSetupUI);

    $("btnStart").addEventListener("click", () => {
      names = parseNames($("names").value);
      n = names.length;
      secretWord = ($("word").value || "").trim();

      if (n < 3) { alert("Pon al menos 3 nombres para jugar."); return; }
      if (!secretWord) { alert("Escribe una palabra secreta."); return; }

      numImpostors = ($("twoImpostors").checked && n >= 5) ? 2 : 1;

      pickImpostors(numImpostors);
      starterIndex = randInt(n);
      i = 0;
      revealed = false;

      $("setup").classList.add("hidden");
      $("reveal").classList.remove("hidden");
      renderHiddenState();
      $("btnNext").disabled = true; // se habilita al soltar tras revelar
    });

    $("btnNext").addEventListener("click", () => {
      i++;
      $("btnNext").disabled = true;
      revealed = false;

      if (i >= n) {
        $("reveal").classList.add("hidden");
        $("final").classList.remove("hidden");
        $("starter").textContent = `Empieza: ${getPlayerName(starterIndex)}`;
        return;
      }
      renderHiddenState();
    });

    $("btnRestart").addEventListener("click", () => {
      $("word").value = "";
      resetUI();
      refreshSetupUI();
    });

    // --- HOLD TO REVEAL (mouse + touch) ---
    const holdBox = $("holdBox");

    // Mouse
    holdBox.addEventListener("mousedown", (e) => { e.preventDefault(); reveal(); });
    window.addEventListener("mouseup", () => hide());
    holdBox.addEventListener("mouseleave", () => hide());

    // Touch (iOS)
    holdBox.addEventListener("touchstart", (e) => {
      lastTouch = Date.now();
      e.preventDefault();
      reveal();
    }, { passive:false });

    holdBox.addEventListener("touchend", (e) => {
      e.preventDefault();
      hide();
    }, { passive:false });

    holdBox.addEventListener("touchcancel", () => hide(), { passive:true });

    // Evita doble disparo (touch->mouse)
    holdBox.addEventListener("click", (e) => {
      if (Date.now() - lastTouch < 600) { e.preventDefault(); return; }
    });

    // init
    refreshSetupUI();
    resetUI();
  </script>
</body>
</html>
