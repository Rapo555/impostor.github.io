<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego del Impostor</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 0; background:#0b0b0f; color:#fff; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 18px; }
    .card { background:#141422; border:1px solid #2a2a3c; border-radius: 16px; padding: 16px; margin: 14px 0; }
    label { display:block; font-size: 14px; color:#cfcfe6; margin-bottom:6px; }
    input, textarea, select {
      width:100%; padding:12px 12px; border-radius:12px;
      border:1px solid #2a2a3c; background:#0f0f18; color:#fff; font-size:16px;
    }
    textarea { min-height: 140px; resize: vertical; }
    button { width:100%; padding:12px 12px; border-radius:12px; border:0; background:#5b5bff; color:#fff; font-size:16px; font-weight:700; cursor:pointer; }
    button.secondary { background:#2a2a3c; }
    .big { font-size: 22px; font-weight: 800; }
    .muted { color:#b8b8d6; }
    .row { display:flex; gap:10px; }
    .row > * { flex:1; }
    .hidden { display:none; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; background:#2a2a3c; color:#d9d9ff; font-size: 13px; }

    /* RECT√ÅNGULO GRANDE (HOLD TO REVEAL) */
    .holdBox{
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
      margin-top: 12px;
      border-radius: 18px;
      border: 1px solid #2a2a3c;
      background: linear-gradient(180deg, #11112a 0%, #0f0f18 100%);
      min-height: 230px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 18px;
      box-shadow: 0 18px 40px rgba(0,0,0,.45);
    }
    .holdTitle{ font-size: 18px; font-weight: 800; margin-bottom: 6px; }
    .holdHint{ font-size: 14px; color:#b8b8d6; }
    .holdMain{ font-size: 22px; font-weight: 900; line-height: 1.25; }
    .holdSub{ margin-top: 10px; font-size: 14px; color:#cfcfe6; }
    .danger{ color:#ff6b6b; }
    .ok{ color:#8affb1; }

    /* switch simple */
    .switchRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:10px; }
    .switchHint{ font-size: 13px; color:#b8b8d6; }
    .toggle{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:12px;
      border:1px solid #2a2a3c; background:#0f0f18;
    }
    .toggle input{ width:auto; }
    .disabledBox{ opacity:.55; }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 640px){ .grid2{ grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="big">Juego del Impostor</div>
      <div class="muted">Escribe nombres (uno por l√≠nea) y elige categor√≠a. Luego p√°sale el tel√©fono a cada quien para ver su rol.</div>
    </div>

    <div id="setup" class="card">
      <label>Nombres (uno por l√≠nea)</label>
      <textarea id="names" placeholder="Ej.
V√≠ctor
Ana
Luis
Sof√≠a"></textarea>

      <div class="muted" style="margin-top:6px">
        Jugadores detectados: <b id="count">0</b> (m√≠nimo 3).
      </div>

      <div class="switchRow" id="twoImpBox">
        <div>
          <div class="toggle">
            <input id="twoImpostors" type="checkbox" />
            <label for="twoImpostors" style="margin:0; color:#d9d9ff;">Jugar con 2 impostores</label>
          </div>
          <div class="switchHint" id="twoImpHint">Disponible a partir de 5 jugadores.</div>
        </div>
        <span class="pill" id="impCountPill">Impostores: 1</span>
      </div>

      <div style="height:12px"></div>

      <div class="grid2">
        <div>
          <label>Categor√≠a</label>
          <select id="category"></select>
          <div class="muted" style="margin-top:6px">
            La palabra se elige al azar al iniciar.
          </div>
        </div>
        <div>
          <label>Palabra elegida</label>
          <input id="pickedWord" type="text" readonly value="(se mostrar√° al iniciar)" />
          <div class="muted" style="margin-top:6px">
            (Solo para el host; los jugadores NO la ven aqu√≠)
          </div>
        </div>
      </div>

      <div id="customBox" class="hidden" style="margin-top:12px">
        <label>Lista personalizada (una palabra por l√≠nea)</label>
        <textarea id="customWords" placeholder="Ej.
Tibur√≥n
Helado
Desierto
Tenis"></textarea>
        <div class="muted" style="margin-top:6px">
          Se tomar√° una palabra al azar de aqu√≠ (m√≠nimo 3).
        </div>
      </div>

      <div style="height:14px"></div>
      <button id="btnStart">Iniciar reparto</button>
      <div style="height:10px"></div>
      <div class="muted">Tip: mant√©n presionado para ver tu rol, suelta para ocultarlo üòâ</div>
    </div>

    <div id="reveal" class="card hidden">
      <div class="pill" id="counter">Turno</div>

      <div id="holdBox" class="holdBox" role="button" aria-label="Mant√©n presionado para revelar">
        <div>
          <div class="holdTitle" id="turnName">Le toca a:</div>
          <div class="holdMain" id="turnLabel">Jugador</div>
          <div class="holdSub" id="holdHint">Mant√©n presionado para ver tu rol</div>
        </div>
      </div>

      <div style="height:12px"></div>
      <button id="btnNext" class="secondary" disabled>Siguiente jugador</button>
      <div class="muted" style="margin-top:10px">El bot√≥n se habilita cuando sueltas (para que no avancen sin ocultar).</div>
    </div>

    <div id="final" class="card hidden">
      <div class="big">¬°Listo!</div>
      <div class="muted">Ya todos vieron su rol.</div>
      <div style="height:14px"></div>
      <div class="big" id="starter"></div>
      <div style="height:14px"></div>
      <button class="secondary" id="btnRestart">Reiniciar</button>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // ‚úÖ Listas de palabras por categor√≠a (ed√≠talas a gusto)
    const WORDS = {
      "Jugadores de f√∫tbol": [
        "Messi","Cristiano Ronaldo","Mbapp√©","Haaland","Neymar","Modriƒá","Benzema","Salah","De Bruyne","Lewandowski",
        "Vin√≠cius Jr.","Bellingham","Kane","Griezmann","Son Heung-min","Kvaratskhelia","Pedri","Gavi","Valverde","Courtois"
      ],
      "Personas famosas": [
        "Taylor Swift","Bad Bunny","The Rock","Shakira","Ariana Grande","Lionel Messi","Kanye West","Billie Eilish","Drake","Zendaya",
        "Leonardo DiCaprio","Dua Lipa","Selena Gomez","Tom Holland","Rihanna","Beyonc√©","MrBeast","Keanu Reeves","Harry Styles","Cillian Murphy"
      ],
      "Pel√≠culas/Series": [
        "Stranger Things","Breaking Bad","Game of Thrones","Narcos","The Office","Friends","Dark","La Casa de Papel","The Boys","The Mandalorian",
        "Harry Potter","Star Wars","Avengers","Titanic","Shrek","Toy Story","Interstellar","Inception","Joker","Spider-Man"
      ],
      "Animales": [
        "Tibur√≥n","Delf√≠n","Ping√ºino","Jaguar","Elefante","Gorila","√Åguila","Tortuga","Pulpo","Zorro","Lobo","Oso","Camale√≥n","Caballo","Koala"
      ],
      "Objetos": [
        "Celular","Aud√≠fonos","Mochila","Llaves","Control remoto","Cargador","Vaso","L√°mpara","Silla","Laptop","Reloj","Gorra","Libro","C√°mara"
      ],
      "Lista personalizada": [] // se llena con textarea
    };

    let n = 0;
    let secretWord = "";
    let impostorIndices = new Set(); // set de indices impostores
    let starterIndex = -1;
    let i = 0;                // jugador actual
    let names = [];           // lista de nombres
    let revealed = false;     // si est√° revelado (presionado)
    let lastTouch = 0;
    let numImpostors = 1;

    function randInt(max) { return Math.floor(Math.random() * max); }

    // Parse de nombres (uno por l√≠nea, elimina vac√≠os)
    function parseLines(raw){
      return (raw || "")
        .split("\n")
        .map(s => s.trim())
        .filter(s => s.length > 0);
    }

    function getPlayerName(idx){
      return (names[idx] && names[idx].trim()) ? names[idx].trim() : `Jugador ${idx + 1}`;
    }

    function updateCounter() {
      $("counter").textContent = `Turno: ${getPlayerName(i)} (${i + 1} de ${n})`;
      $("turnLabel").textContent = getPlayerName(i);
      $("turnName").textContent = "Le toca a:";
    }

    function roleFor(idx) {
      if (impostorIndices.has(idx)) return { text: "üö® Eres el impostor", kind: "danger" };
      return { text: `‚úÖ Tu palabra: ${secretWord}`, kind: "ok" };
    }

    function renderHiddenState(){
      updateCounter();
      $("holdHint").textContent = "Mant√©n presionado para ver tu rol";
      $("turnName").textContent = "Le toca a:";
      $("turnLabel").textContent = getPlayerName(i);
      $("turnLabel").classList.remove("danger", "ok");
    }

    function renderRevealedState(){
      const r = roleFor(i);
      $("turnName").textContent = "Tu rol:";
      $("turnLabel").textContent = r.text;
      $("turnLabel").classList.remove("danger", "ok");
      $("turnLabel").classList.add(r.kind);
      $("holdHint").textContent = "Suelta para ocultar y pasar el tel√©fono";
    }

    function reveal(){
      if (revealed) return;
      revealed = true;
      $("btnNext").disabled = true;
      renderRevealedState();
    }

    function hide(){
      if (!revealed) return;
      revealed = false;
      renderHiddenState();
      $("btnNext").disabled = false;
    }

    function resetUI() {
      $("setup").classList.remove("hidden");
      $("reveal").classList.add("hidden");
      $("final").classList.add("hidden");
      $("btnNext").disabled = true;
      revealed = false;
      renderHiddenState();
    }

    function pickImpostors(count){
      impostorIndices = new Set();
      while (impostorIndices.size < count) {
        impostorIndices.add(randInt(n));
      }
    }

    function pickRandomWord(list){
      return list[randInt(list.length)];
    }

    // --- UI Setup: categor√≠as ---
    function initCategories(){
      const sel = $("category");
      sel.innerHTML = "";
      Object.keys(WORDS).forEach((k) => {
        const opt = document.createElement("option");
        opt.value = k;
        opt.textContent = k;
        sel.appendChild(opt);
      });
      sel.value = "Jugadores de f√∫tbol";
    }

    function refreshCustomVisibility(){
      const isCustom = $("category").value === "Lista personalizada";
      $("customBox").classList.toggle("hidden", !isCustom);
    }

    // --- UI setup: contar nombres y habilitar 2 impostores ---
    function refreshSetupUI(){
      names = parseLines($("names").value);
      n = names.length;
      $("count").textContent = String(n);

      const canTwo = n >= 5;
      const cb = $("twoImpostors");
      const box = $("twoImpBox");
      const hint = $("twoImpHint");

      if (!canTwo) {
        cb.checked = false;
        cb.disabled = true;
        box.classList.add("disabledBox");
        hint.textContent = "Disponible a partir de 5 jugadores.";
        numImpostors = 1;
      } else {
        cb.disabled = false;
        box.classList.remove("disabledBox");
        hint.textContent = "Act√≠valo si quieren m√°s caos üòà";
        numImpostors = cb.checked ? 2 : 1;
      }

      $("impCountPill").textContent = `Impostores: ${numImpostors}`;
    }

    $("names").addEventListener("input", refreshSetupUI);
    $("twoImpostors").addEventListener("change", refreshSetupUI);
    $("category").addEventListener("change", () => { refreshCustomVisibility(); });

    $("btnStart").addEventListener("click", () => {
      names = parseLines($("names").value);
      n = names.length;

      if (n < 3) { alert("Pon al menos 3 nombres para jugar."); return; }

      numImpostors = ($("twoImpostors").checked && n >= 5) ? 2 : 1;

      // Elegir palabra al azar seg√∫n categor√≠a
      const cat = $("category").value;
      let pool = WORDS[cat] || [];

      if (cat === "Lista personalizada") {
        pool = parseLines($("customWords").value);
        if (pool.length < 3) {
          alert("En la lista personalizada pon al menos 3 palabras (una por l√≠nea).");
          return;
        }
      } else {
        if (!Array.isArray(pool) || pool.length === 0) {
          alert("Esa categor√≠a no tiene palabras. Edita el array WORDS en el c√≥digo.");
          return;
        }
      }

      secretWord = pickRandomWord(pool);
      $("pickedWord").value = secretWord; // solo para el host en setup

      pickImpostors(numImpostors);
      starterIndex = randInt(n);
      i = 0;
      revealed = false;

      $("setup").classList.add("hidden");
      $("reveal").classList.remove("hidden");
      renderHiddenState();
      $("btnNext").disabled = true; // se habilita al soltar tras revelar
    });

    $("btnNext").addEventListener("click", () => {
      i++;
      $("btnNext").disabled = true;
      revealed = false;

      if (i >= n) {
        $("reveal").classList.add("hidden");
        $("final").classList.remove("hidden");
        $("starter").textContent = `Empieza: ${getPlayerName(starterIndex)}`;
        return;
      }
      renderHiddenState();
    });

    $("btnRestart").addEventListener("click", () => {
      $("pickedWord").value = "(se mostrar√° al iniciar)";
      resetUI();
      refreshSetupUI();
    });

    // --- HOLD TO REVEAL (mouse + touch) ---
    const holdBox = $("holdBox");

    // Mouse
    holdBox.addEventListener("mousedown", (e) => { e.preventDefault(); reveal(); });
    window.addEventListener("mouseup", () => hide());
    holdBox.addEventListener("mouseleave", () => hide());

    // Touch (iOS)
    holdBox.addEventListener("touchstart", (e) => {
      lastTouch = Date.now();
      e.preventDefault();
      reveal();
    }, { passive:false });

    holdBox.addEventListener("touchend", (e) => {
      e.preventDefault();
      hide();
    }, { passive:false });

    holdBox.addEventListener("touchcancel", () => hide(), { passive:true });

    // Evita doble disparo (touch->mouse)
    holdBox.addEventListener("click", (e) => {
      if (Date.now() - lastTouch < 600) { e.preventDefault(); return; }
    });

    // init
    initCategories();
    refreshCustomVisibility();
    refreshSetupUI();
    resetUI();
  </script>
</body>
</html>
