<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Recurso Did치ctico: Seguro de Vida</title>
    <style>
        :root { --primary: #2563eb; --danger: #ef4444; --success: #10b981; --dark: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; display: flex; justify-content: center; padding: 20px; color: var(--dark); }
        .container { background: white; padding: 2rem; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); max-width: 800px; width: 100%; text-align: center; }
        
        /* Dashboard de Simulaci칩n */
        .dashboard { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px; }
        .panel { background: #f8fafc; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; }
        .big-num { display: block; font-size: 1.8rem; font-weight: bold; color: var(--primary); }

        /* 츼rea Visual del Personaje */
        .stage { position: relative; height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; background: #fff; border-radius: 20px; margin: 10px 0; }
        .emoji { font-size: 80px; transition: all 0.5s; z-index: 2; }
        .years-badge { background: var(--dark); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; margin-bottom: 10px; }
        
        /* Animaci칩n del Valor Presente */
        .floating-value {
            position: absolute; color: var(--success); font-weight: bold; font-size: 1.5rem;
            opacity: 0; pointer-events: none; z-index: 3;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-120px); opacity: 0; }
        }

        /* Ruleta y Botones */
        .roulette-container { position: relative; width: 200px; height: 200px; margin: 0 auto 20px; }
        #canvas { border-radius: 50%; transition: transform 2.5s cubic-bezier(0.1, 0, 0.2, 1); width: 100%; height: 100%; }
        .pointer { position: absolute; top: -5px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 20px solid #333; z-index: 10; }

        button { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 12px; cursor: pointer; font-size: 1.1rem; font-weight: 600; width: 100%; }
        button:disabled { background: #cbd5e1; }

        /* Tabla de Historial */
        .history-section { margin-top: 30px; text-align: left; }
        .scroll-table { max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th { position: sticky; top: 0; background: #f1f5f9; padding: 10px; font-size: 0.8rem; }
        td { padding: 8px 10px; border-bottom: 1px solid #eee; text-align: center; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <h2>Simulador de Valor Esperado (Tasa 5%)</h2>

    <div class="dashboard">
        <div class="panel">Simulaciones Completas<span class="big-num" id="totalSims">0</span></div>
        <div class="panel">Promedio de VP<span class="big-num" id="avgVP">$0.00</span></div>
    </div>

    <div class="stage">
        <div id="floatVal" class="floating-value">+$0,000</div>
        <div class="years-badge">A침os Sobrevividos: <span id="yearsCount">0</span></div>
        <div id="charEmoji" class="emoji">游땕</div>
    </div>

    <div class="roulette-container">
        <div class="pointer"></div>
        <canvas id="canvas" width="200" height="200"></canvas>
    </div>

    <button id="spinBtn" onclick="girar()">Girar Ruleta (A침o <span id="btnYear">1</span>)</button>
    <button id="resetBtn" onclick="resetSim()" style="display:none; background:#64748b; margin-top:10px;">Nueva Persona</button>

    <div class="history-section">
        <h3>Historial de Simulaciones</h3>
        <div class="scroll-table">
            <table>
                <thead>
                    <tr><th>Sim #</th><th>A침o Muerte</th><th>Valor Presente Pagado</th></tr>
                </thead>
                <tbody id="historyBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Estado de la persona actual
    let a침oActual = 1;
    let finalizado = false;
    let rotation = 0;

    // Estado global de estad칤sticas
    let totalSimulaciones = 0;
    let sumaVP = 0;

    function draw() {
        const slice = (Math.PI * 2) / 20;
        ctx.clearRect(0,0,200,200);
        // Rojo (Muerte)
        ctx.beginPath(); ctx.moveTo(100,100);
        ctx.arc(100,100,98, -Math.PI/2, -Math.PI/2 + (slice * a침oActual));
        ctx.fillStyle = '#ef4444'; ctx.fill();
        // Verde (Vida)
        ctx.beginPath(); ctx.moveTo(100,100);
        ctx.arc(100,100,98, -Math.PI/2 + (slice * a침oActual), -Math.PI/2 + (Math.PI*2));
        ctx.fillStyle = '#10b981'; ctx.fill();
        ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.stroke();
    }

    function girar() {
        if(finalizado) return;
        document.getElementById('spinBtn').disabled = true;
        
        const extraDeg = Math.floor(Math.random() * 360) + 1080; 
        rotation += extraDeg;
        canvas.style.transform = `rotate(${rotation}deg)`;

        setTimeout(() => {
            const normalizedAngle = (360 - (rotation % 360)) % 360;
            const landInRed = normalizedAngle < (a침oActual / 20 * 360);
            
            if (landInRed) {
                morir();
            } else {
                sobrevivir();
            }
        }, 2600);
    }

    function sobrevivir() {
        a침oActual++;
        document.getElementById('yearsCount').innerText = a침oActual - 1;
        document.getElementById('btnYear').innerText = a침oActual;
        document.getElementById('spinBtn').disabled = false;
        draw();
    }

    function morir() {
        finalizado = true;
        const vp = 10000 / Math.pow(1.05, a침oActual);
        
        // Animaciones visuales
        document.getElementById('charEmoji').innerText = "游";
        const floatVal = document.getElementById('floatVal');
        floatVal.innerText = `+$${vp.toLocaleString(undefined, {minimumFractionDigits:2})}`;
        floatVal.style.animation = "floatUp 2s forwards";

        // Actualizar Estad칤sticas Globales
        totalSimulaciones++;
        sumaVP += vp;
        
        // Actualizar UI
        document.getElementById('totalSims').innerText = totalSimulaciones;
        document.getElementById('avgVP').innerText = `$${(sumaVP / totalSimulaciones).toLocaleString(undefined, {minimumFractionDigits:2})}`;
        
        // Agregar a la tabla
        const row = document.getElementById('historyBody').insertRow(0);
        row.innerHTML = `<td>${totalSimulaciones}</td><td>A침o ${a침oActual}</td><td>$${vp.toLocaleString()}</td>`;

        document.getElementById('spinBtn').style.display = "none";
        document.getElementById('resetBtn').style.display = "block";
    }

    function resetSim() {
        a침oActual = 1;
        finalizado = false;
        document.getElementById('charEmoji').innerText = "游땕";
        document.getElementById('yearsCount').innerText = "0";
        document.getElementById('btnYear').innerText = "1";
        document.getElementById('floatVal').style.animation = "none";
        document.getElementById('spinBtn').style.display = "block";
        document.getElementById('spinBtn').disabled = false;
        document.getElementById('resetBtn').style.display = "none";
        draw();
    }

    draw();
</script>

</body>
</html>
